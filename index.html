<html>
  <head>
    <title>Evillu - The AR Experience</title>
    <link rel="icon" type="image/png" href="assets/images/evilogo.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/css/index.css">
    <link rel="stylesheet" href="assets/css/navbar.css">
    <link rel="stylesheet" href="assets/css/ar.css">
    <link rel="stylesheet" href="assets/css/silent.css">
    <link rel="stylesheet" href="assets/external/flickity.css">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="assets/external/flickity.js"></script>
  </head>
  <body>
    <div id="main-container" onclick="closeNav()">
    </div>
    <div id="navbar" class="navbar">
      <a class="header" href="#">Evillu</a>
      <a id="ar-exp-nav" href="#" onclick="clickLink('ar-exp-nav')">AR Experience</a>
      <a id="silent-nav" href="#" onclick="clickLink('silent-nav')">Silent Book</a>
      <a id="alszol-nav" href="#" onclick="clickLink('alszol-nav')">Te j√≥l alszol?</a>
    </div>
    <div class="button-container">
      <img id="hamburger" src="assets/images/hamburger.png" class="button" onclick="openNav()">
      <div style="width: 100%; height: 7vh; margin: 2%; padding: 1%;" onclick="closeNav()"></div>
      <img id="instaLogo" src="assets/images/instagram.png" class="button">
    </div>
  </body>
</html>
<script>

  function openNav() {
    document.getElementById("navbar").style.width = "250px";
    document.getElementById("hamburger").setAttribute("onClick", "closeNav()");
  }

  function closeNav() {
    document.getElementById("navbar").style.width = "0";
    document.getElementById("hamburger").setAttribute("onClick", "openNav()");
  }

  function loadPage(page) {
    var xhr= new XMLHttpRequest();
    xhr.open('GET', "components/" + page + ".html", true);
    xhr.onreadystatechange= function() {
        if (this.readyState!==4) return;
        if (this.status!==200) return; // or whatever error handling you want
        document.getElementById('main-container').innerHTML= this.responseText;
        if (page == "ar") {
          const sceneEl = document.querySelector('a-scene');
          sceneEl.addEventListener("arReady", (event) => {
            document.getElementsByClassName("mindar-ui-scanning")[0].setAttribute("onClick", "closeNav()");
          });
        } else if (page=="silent-book" || page=="te-jol-alszol") {
          new Flickity( '.main-carousel', {});
        }
    };
    xhr.send();
  }

  function clickLink(id) {
    if (isActive(id)) {
      return;
    }

    switch (id) {
      case "ar-exp-nav":
        loadPage("ar")
        break;
      case "silent-nav":
        removeAr()
        loadPage("silent-book")
        break;
      case "alszol-nav":
        removeAr()
        loadPage("te-jol-alszol")
        break;
    }
    makeActive(id)
  }

  function removeAr() {
    document.querySelectorAll('.mindar-ui-overlay:not(.evillu-ai-overlay)').forEach( (element) => {
      element.parentNode.removeChild(element);
    });
  }

  function isActive(id) {
    return document.getElementById(id).classList.contains("active");
  }

  function makeActive(id) {
    ["ar-exp-nav","silent-nav","alszol-nav"].forEach((item) => {
      elem = document.getElementById(item);
      if (id == item) {
        elem.classList.add("active")
      } else {
        elem.classList.remove("active")
      }
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    loadPage('ar');
    makeActive("ar-exp-nav")
  }, false);

  document.getElementById('instaLogo').addEventListener('click', () => {
    if (/Mobi|Android/i.test(navigator.userAgent)) {
      window.location.href = "instagram://user?username=_evillu";
    } else {
      window.open("https://www.instagram.com/_evillu/", '_blank');
    }
  });
</script>